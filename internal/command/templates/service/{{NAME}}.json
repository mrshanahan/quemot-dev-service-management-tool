{
    "locations": [
        {
            "type": "local",
            "name": "local"
        },
        {
            "type": "ssh",
            "name": "quemot.dev",
            "server": "quemot.dev:22",
            "username": "{{ SSH_USERNAME }}",
            "key_file": "{{ SSH_KEY_FILE }}",
            "key_file_passphrase": "{{ SSH_KEY_FILE_PASSPHRASE }}",
            "run_elevated": true
        }
    ],
    "transport": {
        "type": "s3",
        "bucket_url": "s3://quemot-dev-bucket/deploy-assets"
    },
    "assets": [
        {
            "type": "file",
            "name": "docker-compose",
            "src": "local",
            "dst": "*",
            "src_path": "docker-compose.prod.yml",
            "dst_path": "/etc/quemot-dev/{{NAME}}/docker-compose.yml",
            "force": true
        },
        {
            "type": "docker_image",
            "name": "docker-images",
            "src": "local",
            "dst": "*",
            "repository": [
                "{{DOCKER_IMAGE_NAME}}"
            ],
            "compare_label": "dev.quemot.{{NAME}}.image.sha",
            "post_command": [
                {
                    "command": "systemctl is-active {{NAME}}.service >/dev/null && systemctl restart {{NAME}}.service",
                    "trigger": "on_updated"
                }
            ]
        },
        {
            "type": "file",
            "name": "service-install-files",
            "src": "local",
            "dst": "*",
            "src_path": "install/",
            "dst_path": "/etc/quemot-dev/{{NAME}}/install/",
            "force": true,
            "post_command": [
                {
                    "command": "systemctl enable /etc/quemot-dev/{{NAME}}/install/*.service --now",
                    "trigger": "on_changed"
                }
            ]
        },
        {
            "type": "file",
            "name": "nginx-conf",
            "src": "local",
            "dst": "*",
            "src_path": "nginx/{{NAME}}.conf",
            "dst_path": "/etc/nginx/sites-available/{{NAME}}.conf",
            "post_command": [
                {
                    "command": "ln -s /etc/nginx/sites-available/{{NAME}}.conf /etc/nginx/sites-enabled/{{NAME}}.conf",
                    "trigger": "on_created"
                },
                {
                    "command": "nginx -t && nginx -s reload",
                    "trigger": "on_changed"
                }
            ]
        }
    ]
}